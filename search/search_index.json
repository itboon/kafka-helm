{"config":{"lang":["ja"],"separator":"[\\s\\-\uff0c\u3002]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"Welcome","text":"<ul> <li>GitHub</li> <li>Docker Hub</li> </ul>"},{"location":"#apache-kafka","title":"\u5173\u4e8e Apache Kafka","text":"<p>Apache Kafka \u662f\u4e00\u4e2a\u5f00\u6e90\u5206\u5e03\u5f0f\u4e8b\u4ef6\u6d41\u5e73\u53f0\uff0c\u5df2\u88ab\u6570\u5343\u5bb6\u516c\u53f8\u7528\u4e8e\u9ad8\u6027\u80fd\u6570\u636e\u7ba1\u9053\u3001\u6d41\u5206\u6790\u3001\u6570\u636e\u96c6\u6210\u548c\u5173\u952e\u4efb\u52a1\u5e94\u7528\u7a0b\u5e8f\u3002</p>"},{"location":"#_1","title":"\u4e3a\u4f55\u9009\u62e9\u8fd9\u4e2a\u955c\u50cf","text":"<ul> <li>\u5168\u9762\u517c\u5bb9 <code>KRaft</code>, \u4e0d\u4f9d\u8d56 ZooKeeper</li> <li>\u7075\u6d3b\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u8fdb\u884c\u914d\u7f6e\u8986\u76d6</li> <li>\u4e0a\u624b\u7b80\u5355</li> <li>\u63d0\u4f9b <code>helm chart</code>\uff0c\u4f60\u53ef\u4ee5\u5728 Kubernetes \u5feb\u901f\u90e8\u7f72\u9ad8\u53ef\u7528 Kafka \u96c6\u7fa4</li> </ul>"},{"location":"docker/","title":"Docker \u542f\u52a8 Kafka","text":"<p>\u5feb\u901f\u542f\u52a8 Kafka:</p> <pre><code>docker run -d --network host --name demo-kafka-server kafkace/kafka:v3.5.2\n</code></pre>"},{"location":"docker/#_1","title":"\u6570\u636e\u6301\u4e45\u5316","text":"<p>\u6570\u636e\u5b58\u50a8\u8def\u5f84 <code>/opt/kafka/data</code>\uff0c\u6302\u8f7d\u6570\u636e\u5377:</p> <pre><code>docker volume create demo-kafka-data\n\ndocker run -d \\\n--network host \\\n--name demo-kafka-server \\\n-v demo-kafka-data:/opt/kafka/data \\\nkafkace/kafka:v3.5.2\n</code></pre>"},{"location":"docker/#docker-compose","title":"docker compose","text":"<pre><code>version: \"3\"\n\nvolumes:\nkafka-data: {}\n\nservices:\nkafka:\nimage: kafkace/kafka:v3.5.2\nrestart: always\nnetwork_mode: \"host\"\nvolumes:\n- kafka-data:/opt/kafka/data\nenvironment:\n- KAFKA_HEAP_OPTS=-Xmx1024m -Xms1024m\n</code></pre>"},{"location":"env/","title":"\u73af\u5883\u53d8\u91cf","text":""},{"location":"env/#environment-variables","title":"Environment Variables","text":"\u53d8\u91cf \u9ed8\u8ba4\u503c \u63cf\u8ff0 <code>KAFKA_CLUSTER_ID</code> \u968f\u673a\u751f\u6210 Cluster ID <code>KAFKA_BROKER_LISTENER_PORT</code> <code>9092</code> broker \u7aef\u53e3\u53f7\uff0c\u5982\u679c\u914d\u7f6e\u4e86 <code>KAFKA_CFG_LISTENERS</code> \u5219\u6b64\u9879\u5931\u6548 <code>KAFKA_CONTROLLER_LISTENER_PORT</code> <code>19091</code> controller \u7aef\u53e3\u53f7\uff0c\u5982\u679c\u914d\u7f6e\u4e86 <code>KAFKA_CFG_LISTENERS</code> \u5219\u6b64\u9879\u5931\u6548 <code>KAFKA_BROKER_EXTERNAL_HOST</code> null \u5bf9\u5916\u66b4\u9732\u7684\u4e3b\u673a\u540d\uff0c\u53ef\u4ee5\u662f\u57df\u540d\u6216IP\u5730\u5740\uff0c\u5982\u679c\u914d\u7f6e\u4e86 <code>KAFKA_CFG_ADVERTISED_LISTENERS</code> \u5219\u6b64\u9879\u5931\u6548 <code>KAFKA_BROKER_EXTERNAL_PORT</code> <code>29092</code> \u5bf9\u5916\u66b4\u9732\u7684\u7aef\u53e3\u53f7\uff0c\u4e0d\u80fd\u8ddf\u5185\u90e8\u7aef\u53e3\u91cd\u590d\uff0c\u5982\u679c\u914d\u7f6e\u4e86 <code>KAFKA_CFG_ADVERTISED_LISTENERS</code> \u5219\u6b64\u9879\u5931\u6548 <code>KAFKA_HEAP_OPTS</code> <code>null</code> Kafka Java Heap size. \u4f8b\u5982: <code>-Xmx512m -Xms512m</code>"},{"location":"env/#kafka-configurations","title":"Kafka Configurations","text":"<p>\u6240\u6709\u4ee5 <code>KAFKA_CFG_</code> \u5f00\u5934\u7684\u73af\u5883\u53d8\u91cf\u90fd\u5c06\u6620\u5c04\u5230\u5176\u76f8\u5e94\u7684 Apache Kafka \u914d\u7f6e\u9879\u3002</p> <p>\u4f8b\u5982 <code>KAFKA_CFG_LISTENERS</code> \u5bf9\u5e94\u914d\u7f6e\u53c2\u6570 <code>listeners</code>\uff0c<code>KAFKA_CFG_ADVERTISED_LISTENERS</code> \u5bf9\u5e94\u914d\u7f6e\u53c2\u6570 <code>advertised.listeners</code></p> <p>Variable examples:</p> \u53d8\u91cf \u914d\u7f6e\u9879 <code>KAFKA_CFG_PROCESS_ROLES</code> <code>process.roles</code> <code>KAFKA_CFG_LISTENERS</code> <code>listeners</code> <code>KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP</code> <code>listener.security.protocol.map</code> <code>KAFKA_CFG_ADVERTISED_LISTENERS</code> <code>advertised.listeners</code> <code>KAFKA_CFG_CONTROLLER_QUORUM_VOTERS</code> <code>controller.quorum.voters</code> <code>KAFKA_CFG_LOG_RETENTION_HOURS</code> <code>log.retention.hours</code> <p><code>log.dir</code> \u548c <code>log.dirs</code> \u5df2\u7ecf\u88ab\u9501\u5b9a\uff0c\u65e0\u6cd5\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u8fdb\u884c\u8986\u76d6\u3002</p>"},{"location":"external/","title":"Kafka Broker \u5bb9\u5668\u5916\u90e8\u7f51\u7edc","text":"<p>\u5bb9\u5668\u5316\u90e8\u7f72 Kafka\uff0cKafka \u9ed8\u8ba4\u5bf9\u5916\u5ba3\u544a\u7684\u4e3b\u673a\u540d\u662f\u5bb9\u5668IP\u5730\u5740\uff0c\u5916\u90e8\u4e3b\u673a\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\u5bb9\u5668\u5185\u90e8\u7f51\u7edc\u3002\u9700\u8981\u589e\u52a0\u4e00\u4e2a\u5bb9\u5668\u5916\u90e8\u7aef\u53e3\uff0c\u5e76\u5bf9\u5916\u5ba3\u544a\uff0c\u540c\u65f6\u5bb9\u5668\u5185\u90e8\u7aef\u53e3\u4e5f\u9700\u8981\u4fdd\u7559\uff0c\u65b9\u4fbfKafka\u96c6\u7fa4\u5185\u90e8\u901a\u4fe1\u3002</p> <p>\u5185\u5916\u7aef\u53e3\u9700\u8981\u914d\u7f6e <code>listeners</code> <code>advertised.listeners</code> \u8fd9\u4e24\u4e2a\u53c2\u6570\uff0c\u8fdb\u9636\u7248\u7684\u914d\u7f6e\u6848\u4f8b\u8bf7\u53c2\u8003 docker-compose-advanced.yaml</p> <p>\u672c\u9879\u76ee\u5bb9\u5668\u955c\u50cf\u5df2\u7ecf\u7b80\u5316\u4e86\u5185\u5916\u7aef\u53e3\u914d\u7f6e\uff0c\u5185\u90e8\u7aef\u53e3\u9ed8\u8ba4\u662f9092\uff0c\u5916\u90e8\u7f51\u7edc\u53ea\u9700\u8981\u914d\u7f6e <code>KAFKA_BROKER_EXTERNAL_HOST</code> <code>KAFKA_BROKER_EXTERNAL_PORT</code> \u4e24\u4e2a\u73af\u5883\u53d8\u91cf\u5373\u53ef\u3002</p> <p>\u672c\u6587\u4e2d<code>\u5916\u7f51</code>\u3001<code>\u5916\u90e8\u7f51\u7edc</code>\u6307\u7684\u662f\u5bb9\u5668\u5916\u90e8\u7f51\u7edc\uff0c\u4f8b\u5982\u516c\u6709\u4e91VPC\u7f51\u7edc\uff0c\u6570\u636e\u4e2d\u5fc3\u79c1\u6709\u7f51\u7edc\u3002\u5982\u679c\u9700\u8981\u628aKafka\u66b4\u9732\u5230\u4e92\u8054\u7f51\uff0c\u5efa\u8bae\u505a\u597dIP\u767d\u540d\u5355\u7ba1\u7406\u3002</p>"},{"location":"external/#docker-compose","title":"Docker Compose","text":"<pre><code>version: \"3\"\n\nvolumes:\nkafka-data: {}\n\nservices:\nkafka:\nimage: kafkace/kafka:v3.6\n# restart: always\nports:\n- \"29092:29092\"\nvolumes:\n- kafka-data:/opt/kafka/data\nenvironment:\nKAFKA_HEAP_OPTS: \"-Xms1024m -Xmx1024m\"\n## \u5c06\u4e3b\u673a\u540d\u66ff\u6362\u6210\u4f60\u81ea\u5df1\u7684\u5916\u90e8\u4e3b\u673a\u540d\uff0c\u53ef\u4ee5\u662f\u57df\u540d\u6216IP\u5730\u5740\nKAFKA_BROKER_EXTERNAL_HOST: kafka-broker-01.example.com\nKAFKA_BROKER_EXTERNAL_PORT: \"29092\"\n\n## kafka web \u7ba1\u7406 (\u53ef\u9009)\nkafka-ui:\nimage: provectuslabs/kafka-ui:v0.7.1\n# restart: always\nports:\n- \"18080:8080\"\nenvironment:\nDYNAMIC_CONFIG_ENABLED: \"true\"\nKAFKA_CLUSTERS_0_NAME: kafka-demo\nKAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: kafka:9092\n# KAFKA_CLUSTERS_0_READONLY: \"true\"\n</code></pre>"},{"location":"external/#helm","title":"Helm","text":"<p>\u5982\u679c\u9700\u8981\u4ece\u96c6\u7fa4\u5916\u8bbf\u95ee Kafka \u96c6\u7fa4\uff0c\u5219\u5fc5\u987b\u5c06\u6bcf\u4e2a Broker \u66b4\u9732\u5230\u96c6\u7fa4\u5916\uff0c\u652f\u6301 <code>NodePort</code> and <code>LoadBalancer</code> \u4e24\u79cd\u65b9\u5f0f\u3002</p>"},{"location":"external/#chart-values","title":"Chart Values","text":"Key Type Default Description broker.external.enabled bool <code>false</code> \u662f\u5426\u5f00\u542f\u96c6\u7fa4\u5916\u8bbf\u95ee broker.external.type string <code>NodePort</code> <code>NodePort</code> <code>LoadBalancer</code> <code>HostPort</code> or <code>PodIP</code> broker.external.service.annotations object <code>{}</code> External serivce annotations, \u53ef\u7528\u4e8e\u914d\u7f6e <code>LoadBalancer</code> broker.external.autoDiscovery.enabled bool <code>false</code> \u7528\u4e8e\u81ea\u52a8\u53d1\u73b0 <code>NodePort</code> \u7aef\u53e3\u53f7\u548c <code>LoadBalancer</code> \u5730\u5740 broker.external.externalDns.enabled bool <code>false</code> \u5f00\u542f [ExternalDNS]https://github.com/kubernetes-sigs/external-dns \u4e3a\u5916\u90e8\u8bbf\u95ee\u5730\u5740\u6dfb\u52a0\u516c\u5171\u57df\u540d\u89e3\u6790 broker.external.externalDns.domain string <code>\"\"</code> ExternalDNS \u57df\u540d broker.external.externalDns.annotations object <code>{}</code> ExternalDNS service annotations"},{"location":"external/#values","title":"values \u6848\u4f8b","text":"<pre><code>## NodePort example\nbroker:\nreplicaCount: 3\nexternal:\nenabled: true\nservice:\ntype: \"NodePort\"\nannotations: {}\nautoDiscovery:\nenabled: true\n</code></pre> <pre><code>## LoadBalancer example\nbroker:\nreplicaCount: 1\nexternal:\nenabled: true\nservice:\ntype: \"LoadBalancer\"\nannotations: {}\nautoDiscovery:\nenabled: true\n</code></pre>"},{"location":"external/#externaldns","title":"ExternalDNS \u6848\u4f8b","text":"<p>ExternalDNS \u9700\u8981\u53e6\u884c\u90e8\u7f72\uff0c\u53c2\u8003\u6587\u6863:</p> <ul> <li>[Setting up ExternalDNS for Services on AWS]https://kubernetes-sigs.github.io/external-dns/latest/docs/tutorials/aws/</li> </ul> <p>\u5047\u5982 <code>my-external-dns.example.com</code> \u662f ExternalDNS \u7ba1\u7406\u7684\u57df\u540d\uff0c Helm Release \u662f <code>kafka</code>\uff0c\u4ee5\u4e0b\u5206\u522b\u662f NodePort \u548c LoadBalancer \u90e8\u7f72\u6848\u4f8b:</p> <pre><code>## ExternalDNS with NodePort\nbroker:\nreplicaCount: 3\nexternal:\nenabled: true\nservice:\ntype: \"NodePort\"\nannotations: {}\nexternalDns:\nenabled: true\ndomain: \"kafka-dev.my-external-dns.example.com\"\nannotations: {}\n\n## broker \u5916\u90e8\u5730\u5740: kafka-broker-0.kafka-dev.my-external-dns.example.com\n</code></pre> <p>LoadBalancer ExternalDNS \u4f5c\u7528\u5728 external service\uff0c\u5176\u4ed6\u7c7b\u578b ExternalDNS \u4f5c\u7528\u5728 headless service\uff0c \u6240\u4ee5\u7528\u6cd5\u6709\u5dee\u5f02\u3002</p> <pre><code>## ExternalDNS with LoadBalancer\nbroker:\nreplicaCount: 3\nexternal:\nenabled: true\nservice:\ntype: \"LoadBalancer\"\nannotations: {}\nexternalDns:\nenabled: true\ndomain: \"my-external-dns.example.com\"\nannotations: {}\n\n## broker \u5916\u90e8\u5730\u5740: kafka-broker-0.my-external-dns.example.com\n</code></pre> <pre><code>## ExternalDNS with LoadBalancer\nbroker:\nreplicaCount: 3\nexternal:\nenabled: true\nservice:\ntype: \"LoadBalancer\"\nannotations: {}\nexternalDns:\nenabled: true\ndomain: \"my-external-dns.example.com\"\n## hostnamePrefixOverride -- \u4ec5\u4ec5\u9002\u7528 LoadBalancer \u7c7b\u578b\uff0c \u9ed8\u8ba4\u524d\u7f00\u662f pod name\nhostnamePrefixOverride: \"kafka-foo\"\nannotations: {}\n\n## broker \u5916\u90e8\u5730\u5740: kafka-foo-0.my-external-dns.example.com\n</code></pre>"},{"location":"helm/","title":"Kafka helm chart","text":"<p>https://github.com/itboon/kafka-helm</p>"},{"location":"helm/#prerequisites","title":"Prerequisites","text":"<ul> <li>Kubernetes 1.22+</li> <li>Helm 3.3+</li> </ul>"},{"location":"helm/#helm","title":"\u83b7\u53d6 helm \u4ed3\u5e93","text":"<pre><code>helm repo add kafka-repo https://helm-charts.itboon.top/kafka\nhelm repo update kafka-repo\n</code></pre>"},{"location":"helm/#kafka","title":"\u90e8\u7f72 Kafka","text":""},{"location":"helm/#kafka_1","title":"\u90e8\u7f72\u5355\u8282\u70b9 Kafka \u96c6\u7fa4","text":"<pre><code>## \u4e0b\u9762\u7684\u90e8\u7f72\u6848\u4f8b\u5173\u95ed\u4e86\u6301\u4e45\u5316\u5b58\u50a8\uff0c\u4ec5\u4f5c\u4e3a\u6f14\u793a\nhelm upgrade --install kafka \\\n--namespace kafka-demo \\\n--create-namespace \\\n--set broker.persistence.enabled=\"false\" \\\nkafka-repo/kafka\n</code></pre> <pre><code>## \u9ed8\u8ba4\u5df2\u5f00\u542f\u6301\u4e45\u5316\u5b58\u50a8\nhelm upgrade --install kafka \\\n--namespace kafka-demo \\\n--create-namespace \\\nkafka-repo/kafka\n</code></pre>"},{"location":"helm/#broker-controller","title":"\u5c06 broker \u548c controller \u5206\u5f00\u90e8\u7f72","text":"<pre><code>helm upgrade --install kafka \\\n--namespace kafka-demo \\\n--create-namespace \\\n--set broker.combinedMode.enabled=\"false\" \\\n--set controller.replicaCount=\"1\" \\\n--set broker.replicaCount=\"1\" \\\nkafka-repo/kafka\n</code></pre> <p><code>broker.combinedMode.enabled</code> \u6df7\u90e8\u6a21\u5f0f\uff0c\u5373\u8fdb\u7a0b\u540c\u65f6\u5177\u6709 broker + controller \u89d2\u8272\uff0c\u5355\u8282\u70b9\u670d\u52a1\u5668\u542f\u52a8\u4e00\u4e2a Pod \u5373\u53ef\u3002<code>kafka-repo/kafka</code> \u9ed8\u8ba4\u5f00\u542f\u6df7\u90e8\uff0c<code>kafka-repo/kafka-ha</code> \u9ed8\u8ba4\u5173\u95ed\u6df7\u90e8\u3002</p>"},{"location":"helm/#_1","title":"\u90e8\u7f72\u9ad8\u53ef\u7528\u96c6\u7fa4","text":"<pre><code>## kafka-repo/kafka-ha \u9ed8\u8ba4\u90e8\u7f72 3 controller + 3 broker\nhelm upgrade --install kafka \\\n--namespace kafka-demo \\\n--create-namespace \\\nkafka-repo/kafka-ha\n</code></pre> <pre><code>## \u8c03\u6574\u96c6\u7fa4\u8d44\u6e90\u914d\u989d\nhelm upgrade --install kafka \\\n--namespace kafka-demo \\\n--create-namespace \\\n--set controller.replicaCount=\"3\" \\\n--set broker.replicaCount=\"3\" \\\n--set broker.heapOpts=\"-Xms4096m -Xmx4096m\" \\\n--set broker.resources.requests.memory=\"8Gi\" \\\n--set broker.resources.limits.memory=\"16Gi\" \\\nkafka-repo/kafka-ha\n</code></pre> <p>More values please refer to examples/values-production.yml</p>"},{"location":"helm/#kafka-broker","title":"Kafka Broker \u914d\u7f6e","text":"<pre><code>## \u5355\u8282\u70b9 Broker \u914d\u7f6e\nbroker:\nreplicaCount: 1\nconfig:\nnum.partitions: \"2\"\n</code></pre> <pre><code>## \u9ad8\u53ef\u7528\u96c6\u7fa4\u63a8\u8350\u914d\u7f6e\nbroker:\nreplicaCount: 3\nconfig:\nnum.partitions: \"6\"\ndefault.replication.factor: \"3\"\nmin.insync.replicas: \"2\"\n</code></pre> <p><code>broker.config</code> \u67d0\u4e9b\u5173\u952e\u914d\u7f6e\u4f1a\u88ab\u73af\u5883\u53d8\u91cf\u8986\u76d6\uff0c\u4f8b\u5982: node.id advertised.listeners controller.quorum.voters \u7b49</p>"},{"location":"helm/#_2","title":"\u96c6\u7fa4\u5916\u8bbf\u95ee","text":"<p>\u8bf7\u53c2\u8003 https://github.com/itboon/kafka-helm/blob/main/docs/external.md</p>"},{"location":"kraft/","title":"KRaft","text":"<p>This project uses KRaft mode by default</p> <p>In KRaft mode each Kafka server can be configured as a controller, a broker, or both using the process.roles property. This property can have the following values:</p> <ul> <li>If process.roles is set to broker, the server acts as a broker.</li> <li>If process.roles is set to controller, the server acts as a controller.</li> <li>If process.roles is set to broker,controller, the server acts as both a broker and a controller.</li> <li>If process.roles is not set at all, it is assumed to be in ZooKeeper mode.</li> </ul> <p>Kafka servers that act as both brokers and controllers are referred to as \"combined\" servers. Combined servers are simpler to operate for small use cases like a development environment. The key disadvantage is that the controller will be less isolated from the rest of the system. For example, it is not possible to roll or scale the controllers separately from the brokers in combined mode. Combined mode is not recommended in critical deployment environments.</p>"},{"location":"network/","title":"Kafka \u9ad8\u7ea7\u7f51\u7edc\u914d\u7f6e","text":"<pre><code>version: \"3\"\n\nvolumes:\nkafka-data: {}\n\nservices:\nkafka:\nimage: kafkace/kafka:v3.5.2\n# restart: always\nports:\n- \"29092:29092\"\nvolumes:\n- kafka-data:/opt/kafka/data\nenvironment:\n- KAFKA_HEAP_OPTS=-Xmx1024m -Xms1024m\n- KAFKA_CFG_INTER_BROKER_LISTENER_NAME=INTERNAL\n- KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT\n- KAFKA_CFG_LISTENERS=CONTROLLER://:9091,INTERNAL://:9092,EXTERNAL://:29092\n## \u5c06\u4e0b\u9762 ${KAFKA_BROKER_EXTERNAL_HOST} \u66ff\u6362\u6210\u4f60\u81ea\u5df1\u7684\u5916\u90e8\u4e3b\u673a\u540d\uff0c\u53ef\u4ee5\u662f\u57df\u540d\u6216IP\u5730\u5740\n- KAFKA_CFG_ADVERTISED_LISTENERS=INTERNAL://:9092,EXTERNAL://${KAFKA_BROKER_EXTERNAL_HOST}:29092\n- KAFKA_CFG_NODE_ID=1\n- KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=1@kafka:9091\n\n## kafka web \u7ba1\u7406 (\u53ef\u9009)\nkafka-ui:\nimage: provectuslabs/kafka-ui:v0.7.1\n# restart: always\nports:\n- \"18080:8080\"\nenvironment:\n- KAFKA_CLUSTERS_0_NAME=kafka-demo\n- KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=kafka:9092\n#- KAFKA_CLUSTERS_0_READONLY=true\n\n### \u5185\u90e8\u7f51\u7edc\n## broker \u9ed8\u8ba4\u5185\u90e8\u7aef\u53e3 9092\n## bootstrap-server: kafka:9092\n\n### \u5916\u90e8\u7f51\u7edc\n## broker \u9ed8\u8ba4\u5916\u90e8\u7aef\u53e3 29092\n## bootstrap-server: ${KAFKA_BROKER_EXTERNAL_HOST}:29092\n</code></pre>"}]}